## 2. 特定スペースの構造化ログ抽出システム

### 2.1. システムの目的
指定した特定のチャットスペースにおける1日分の全発言を、スレッドや引用といった会話の構造を維持した状態で抽出し、テキストデータとして外部保存する。

### 2.2. システム構成
* **実行環境:** Google Apps Script (GAS)
* **主要API:** Google Chat API (`spaces.messages.list`)
* **実行トリガー:** GASのタイムドリブントリガー（毎日 23:50 頃に実行）
* **出力先:** Google Driveの指定フォルダ

### 2.3. 処理フロー
1. **データ取得:** 対象スペースのIDを指定して `spaces.messages.list` メソッドを実行し、メッセージ一覧（JSON配列）を取得する。
    * ※ページネーション (`pageToken`) に対応し、全件取得ループを実装する。
2. **フィルタリング:** 取得したメッセージ群から、`createTime` が当日の0:00〜23:59に含まれるものだけを抽出する。
3. **データ構造化（グループ化・ソート）:**
    * 各メッセージの `thread.name` をキーとしてデータをグループ化する。
    * 親メッセージ（スレッド起点）を `createTime` の昇順にソートする。
    * 各親メッセージに紐づくリプライ（返信）メッセージを、同様に昇順にソートしてぶら下げる。
4. **テキスト整形:** 以下のルールに従いテキスト文字列を生成する。
    * **親メッセージ:** `[YYYY-MM-DD HH:mm] {送信者名}: {テキスト}`
    * **リプライ:** 行頭にインデント（例: `  ┗ `）を付与する。
    * **書式:** `annotations` データに基づき、メンション等の特殊なテキスト表現をプレーンテキスト向けに変換する（例: 引用部分は `>` を付与する）。
5. **ファイル保存:** 生成したテキスト文字列を `YYYYMMDD_{スペース名}_chatlog.txt` としてGoogle Driveにファイル作成する。

### 2.4. データ構造イメージ（出力ファイル例）
```text
[2026-02-26 09:00] 田中 太郎: 本日のタスク共有をお願いします。
  ┗ [2026-02-26 09:15] 鈴木 花子: 私はAプロジェクトの設計書を作成します。
  ┗ [2026-02-26 09:30] 佐藤 次郎: 私はBプロジェクトのバグ修正を行います。
[2026-02-26 13:00] 鈴木 花子: > 私はAプロジェクトの設計書を作成します。
完了しました。レビューをお願いします。
```

###  2.5. 前提条件・制約事項
* 認証: Google Cloud プロジェクトにて Google Chat API を有効化し、適切なスコープ（例: https://www.googleapis.com/auth/chat.messages.readonly）での認証設定（OAuthまたはサービスアカウント）が必要。
* 削除済みメッセージ: API実行時点で既に削除されているメッセージは取得できない。
