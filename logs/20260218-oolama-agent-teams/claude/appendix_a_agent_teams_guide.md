# 別添資料A：Agent Teamsアーキテクチャ解説と汎用CrewAI実装ガイド

**対応フェーズ**: 第2フェーズ（Agent Teamsのアーキテクチャ分析と再現方針）

---

## Agent Teamsのアーキテクチャ

### 全体構造

```
┌─────────────────────────────────────────────────────┐
│              リードエージェント（Team Lead）             │
│  - タスクの分解・割り当て                               │
│  - チームの生成・管理                                  │
│  - 結果の統合・報告                                    │
└──┬──────────┬──────────┬────────────────────────────┘
   │          │          │
   ▼          ▼          ▼
┌──────┐  ┌──────┐  ┌──────┐
│Agent1│  │Agent2│  │Agent3│   ← 各チームメイト（独立コンテキスト）
└──┬───┘  └──┬───┘  └──┬───┘
   ▼         ▼         ▼
┌─────────────────────────────────────────────────────┐
│  ┌──────────┐  ┌──────────┐  ┌──────────┐          │
│  │タスクリスト │  │メッセージ  │  │ファイル    │          │
│  │(JSON files)│  │ボックス   │  │システム    │          │
│  └──────────┘  └──────────┘  └──────────┘          │
└─────────────────────────────────────────────────────┘
```

### ファイル構造

```
~/.claude/teams/{team-name}/
├── config.json          # チームメンバー一覧
└── inboxes/
    ├── team-lead.json   # リーダーのinbox
    ├── worker-1.json    # ワーカー1のinbox
    └── worker-2.json    # ワーカー2のinbox

~/.claude/tasks/{team-name}/
├── 1.json              # タスク #1
├── 2.json              # タスク #2
└── 3.json              # タスク #3
```

### タスクJSON構造

```json
{
  "id": 1,
  "subject": "APIエンドポイントの実装",
  "description": "ユーザー認証用のREST APIを実装する",
  "status": "in_progress",
  "owner": "backend-dev",
  "depends_on": [],
  "created_at": "2026-02-18T10:00:00Z"
}
```

### ライフサイクル

1. チーム作成 → config.json生成
2. タスク作成 → JSONファイル生成、依存関係設定
3. チームメイト生成 → 独立プロセスとしてspawn
4. 作業実行 → タスク取得・実行・メッセージ交換
5. 調整・統合 → リードが進捗監視・結果統合
6. シャットダウン

### サブエージェントとの違い

| 特性 | サブエージェント | Agent Teams |
|------|---------------|-------------|
| 通信 | 親に報告のみ | エージェント間で直接通信 |
| コンテキスト | 親と共有 | 各自独立 |
| 自律性 | 指示された作業を実行 | 自ら仕事を見つけ調整 |
| 構造 | ツリー型 | メッシュ型 |

---

## Agent Teamsに適したタスクパターン

### パターンA：マルチ視点レビュー

各エージェントが異なる専門視点でレビューし、リードが統合する。

### パターンB：競合仮説デバッグ

複数エージェントが異なる仮説を検証し、互いに反証し合う。

### パターンC：クロスレイヤー機能開発

バックエンド・フロントエンド・テストを並列に進め、API仕様の確定時に直接通知。

### パターンD：リサーチ並列処理

複数の調査員がそれぞれ異なる角度で調査し、リードが統合レポートを作成。

### 向いていないタスク

- 1ファイルの編集
- 順序依存性が極めて高いタスク
- 短時間で終わる単純タスク

---

## フレームワーク選定

| ツール | 特徴 | Agent Teams再現度 |
|--------|------|-----------------|
| claude-code-teams-mcp | プロトコル再実装MCPサーバー | ★★★★★ |
| CrewAI | ロールベース、Ollamaネイティブ | ★★★★☆（採用） |
| LangGraph | グラフベース状態管理 | ★★★☆☆ |
| AutoGen | 会話ベースマルチエージェント | ★★★☆☆ |
| OpenCode | Claude Code代替、Ollamaフル対応 | ★★★★☆ |
